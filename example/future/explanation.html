<div>
    <p>
        When this page loads, it has no states registered with ui-router $stateProvider.
        FutureState objects were loaded from futureStates.json using $http service after the
        configuration phase and registered with <code>$futureStateProvider</code>.
    </p>

    <p>
        The three links above go to future state mappings. When navigating to a link, the StateFactory
        promises to make a full ui-router state. When the state is fully resolved, the navigation
        is re-attempted.
    </p>

    <p>
        The 'lazyCtrl' state are created from a StateFactory that uses RequireJS to dynamically
        lazy load a controller function, and then assigns it to the state being created.
    </p>

    <br>

    <div ng-cloak class="ng-cloak panel panel-info">
        <div class="panel-heading">
            <code>requireCtrlStateFactory</code> source code.
        </div>
        <div class="panel-body">
<pre>  function requireCtrlStateFactory($q, futureState) {
    var d = $q.defer(); // make a deferred

    // Tell RequireJS to load lazyController 
    // (leave off the .js)
    require(['lazyController'], function (lazyController) {
      // RequireJS asynchronousely gives us the result of 
      // lazyController.js as the 'lazyController' parameter

      // Define the full UI-Router state using the 
      // lazyController and the injected futureState 
      var fullstate = { controller: lazyController,
        name: futureState.stateName,
        url: futureState.urlPrefix,
        templateUrl: futureState.templateUrl
      };

      // Resolve the promise with the full UI-Router state.
      d.resolve(fullstate);
    });
    
    // The state factory returns the promise
    return d.promise;
  }</pre>
            <p>
                This state factory takes a 'lazyCtrl' <code>FutureState</code> definition, then calls
                RequireJS to dynamically lode the lazyController.js source code. RequireJS returns the
                controller definition to the state factory, which assigns it to the new UI-Router state, which
                is returned (via a promise resolve) to <code>$futureStateProvider</code>.
            </p>

            <p> Then, $futureStateProvider retries the transition. </p>
        </div>
    </div>
    <div ng-cloak class="ng-cloak panel panel-info">
        <div class="panel-heading">
            <code>lazyController.js</code> source code.
        </div>
        <div class="panel-body">
<pre>define(['angular'], function(angular) {
  "use strict";
  return [ '$scope', '$state', function($scope, $state) {
    $scope.somedata = ['foo', 'bar', 'baz' ];
  }]
});</pre>
            <p>
                lazyController.js is wrapped in a RequireJS define. It returns the
                controller function, in the form of a DI-annotated array.
            </p>
        </div>
    </div>
</div>